<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA | Access The Inner Circle</title>
    <meta name="description" content="Secure access to your Aura Apparel account. Experience sustainable luxury.">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        aura: {
                            base: '#F9F7F2',    /* "Rice Paper" Off-White */
                            dark: '#0e231f',    /* "Borneo" Deep Green */
                            forest: '#15302a',  /* Standard Green */
                            charcoal: '#2D2D2D',
                            accent: '#C5A065',  /* "Rattan" Gold */
                            sand: '#E6E2DD',
                            error: '#9B2C2C',
                            success: '#2F855A',
                            surface: '#ffffff'
                        }
                    },
                    fontFamily: {
                        sans: ['Lato', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                        serif: ['Playfair Display', 'ui-serif', 'Georgia', 'serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out forwards',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'spin-slow': 'spin 3s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
        html { scroll-behavior: smooth; }

        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #F9F7F2;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #C5A065;
            border-radius: 3px;
        }

        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #F9F7F2 inset !important;
            -webkit-text-fill-color: #2D2D2D !important;
            transition: background-color 5000s ease-in-out 0s;
        }

        .input-group i {
            transition: all 0.3s ease;
        }
        .input-group:focus-within i {
            color: #15302a;
            transform: translateY(-50%) scale(1.1);
        }
        .input-group input:focus {
            background-color: rgba(255, 255, 255, 0.5);
        }

        .btn-shine {
            position: relative;
            overflow: hidden;
        }
        .btn-shine::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .btn-shine:hover::after {
            left: 100%;
        }
        
        #particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .strength-bar {
            transition: width 0.3s ease-out, background-color 0.3s ease;
        }
    </style>
</head>

<body class="bg-aura-base text-aura-charcoal antialiased min-h-screen flex flex-col lg:flex-row overflow-hidden"
      x-data="authApp()">

    <div class="fixed top-6 right-6 z-[60] flex flex-col gap-3 pointer-events-none">
        <template x-for="toast in toasts" :key="toast.id">
            <div x-show="toast.visible" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-x-12"
                 x-transition:enter-end="opacity-100 translate-x-0"
                 x-transition:leave="transition ease-in duration-300"
                 x-transition:leave-start="opacity-100 translate-x-0"
                 x-transition:leave-end="opacity-0 translate-x-12"
                 class="px-6 py-5 rounded-sm shadow-2xl flex items-start gap-4 min-w-[320px] max-w-md pointer-events-auto border-l-4 backdrop-blur-md"
                 :class="toast.type === 'error' ? 'bg-white/95 text-aura-error border-aura-error' : 'bg-aura-dark/95 text-white border-aura-accent'">
                
                <div class="mt-1">
                    <i :class="toast.type === 'error' ? 'ph-fill ph-warning-circle' : 'ph-fill ph-check-circle'" class="text-xl"></i>
                </div>
                
                <div class="flex-1">
                    <h4 class="font-bold text-xs uppercase tracking-wider mb-1" x-text="toast.title"></h4>
                    <p class="text-xs opacity-90 leading-relaxed font-light" x-text="toast.message"></p>
                </div>
                
                <button @click="removeToast(toast.id)" class="opacity-50 hover:opacity-100 transition">
                    <i class="ph ph-x text-lg"></i>
                </button>
            </div>
        </template>
    </div>

    <div x-show="loading" 
         x-transition.opacity.duration.300ms
         class="fixed inset-0 z-50 bg-aura-base/80 backdrop-blur-sm flex items-center justify-center"
         x-cloak>
        <div class="text-center">
            <div class="relative w-16 h-16 mx-auto mb-4">
                <div class="absolute inset-0 border-4 border-aura-dark/20 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-aura-accent rounded-full border-t-transparent animate-spin"></div>
            </div>
            <p class="text-aura-dark font-serif italic text-lg animate-pulse" x-text="loadingText"></p>
        </div>
    </div>

    <div class="hidden lg:block w-3/5 relative bg-aura-dark overflow-hidden group select-none">
        <canvas id="particle-canvas"></canvas>
        
        <div class="absolute inset-0 bg-gradient-to-b from-aura-dark/30 via-transparent to-aura-dark/90 z-10 pointer-events-none"></div>
        
        <div class="absolute bottom-0 left-0 p-16 z-20 w-full">
            <div class="animate-slide-up" style="animation-delay: 0.2s;">
                <div class="flex items-center gap-4 mb-6">
                    <span class="h-px w-12 bg-aura-accent"></span>
                    <span class="text-aura-accent text-xs font-bold uppercase tracking-[0.3em]">The Inner Circle</span>
                </div>
                
                <h2 class="font-serif text-6xl text-white mb-6 leading-tight">
                    Ethical Fashion, <br>
                    <span class="italic font-light text-white/80">Elevated Standards.</span>
                </h2>
                
                <p class="text-white/60 font-light max-w-lg leading-relaxed mb-10">
                    Join over 15,000 members who choose sustainability without compromising on luxury. Access exclusive collections, early drops, and track your environmental impact.
                </p>

                <div class="bg-white/5 backdrop-blur-md border border-white/10 p-6 rounded-sm max-w-md hover:bg-white/10 transition duration-500">
                    <div class="flex gap-1 text-aura-accent mb-3">
                        <i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i>
                    </div>
                    <p class="text-white/80 italic text-sm mb-4">"The quality of the organic linen is unmatched. I've never felt fabric this breathable yet durable."</p>
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-aura-accent flex items-center justify-center text-aura-dark font-bold text-xs">SJ</div>
                        <span class="text-white/50 text-xs font-bold uppercase tracking-widest">Sarah Jenkins, Verified Buyer</span>
                    </div>
                </div>
            </div>
        </div>

        <a href="index.html" class="absolute top-10 left-10 z-30 text-white/70 hover:text-aura-accent transition duration-300 flex items-center gap-2 text-xs font-bold uppercase tracking-widest group-hover:-translate-x-1">
            <i class="ph ph-arrow-left text-lg"></i> Back to Store
        </a>
    </div>

    <div class="w-full lg:w-2/5 h-full overflow-y-auto bg-aura-base relative flex flex-col">
        
        <div class="lg:hidden p-6 flex justify-between items-center">
            <a href="index.html" class="text-aura-dark/70"><i class="ph ph-arrow-left text-2xl"></i></a>
            <span class="font-serif font-bold text-aura-dark">AURA.</span>
            <div class="w-6"></div> 
        </div>

        <div class="flex-1 flex flex-col justify-center px-8 sm:px-16 py-12">
            
            <div class="hidden lg:block text-center mb-12 animate-fade-in">
                <a href="index.html" class="inline-block hover:opacity-80 transition">
                    <span class="text-4xl font-serif font-bold tracking-[0.2em] uppercase text-aura-dark">
                        Aura<span class="text-aura-accent">.</span>
                    </span>
                </a>
            </div>

            <div class="flex border-b border-gray-200 mb-10 w-full max-w-sm mx-auto animate-fade-in" style="animation-delay: 0.1s;">
                <button @click="switchMode('login')" 
                        type="button"
                        class="w-1/2 pb-4 text-xs font-bold uppercase tracking-widest transition-all duration-300 border-b-2 relative overflow-hidden focus:outline-none"
                        :class="mode === 'login' ? 'text-aura-dark border-aura-dark' : 'text-gray-400 border-transparent hover:text-aura-dark'">
                    Sign In
                    <span x-show="mode === 'login'" class="absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-aura-dark rounded-full mb-1 opacity-0 animate-ping"></span>
                </button>
                <button @click="switchMode('signup')" 
                        type="button"
                        class="w-1/2 pb-4 text-xs font-bold uppercase tracking-widest transition-all duration-300 border-b-2 relative focus:outline-none"
                        :class="mode === 'signup' ? 'text-aura-dark border-aura-dark' : 'text-gray-400 border-transparent hover:text-aura-dark'">
                    Register
                </button>
            </div>

            <form @submit.prevent="handleSubmit" class="w-full max-w-sm mx-auto space-y-6 animate-fade-in" style="animation-delay: 0.2s;" novalidate>
                
                <div>
                    <label class="flex justify-between items-center text-[10px] font-bold uppercase tracking-widest text-aura-charcoal/60 mb-2">
                        <span>Email Address</span>
                        <span x-show="email && !isEmailValid" class="text-aura-error normal-case tracking-normal italic">Invalid format</span>
                    </label>
                    <div class="relative input-group">
                        <i class="ph ph-envelope absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        
                        <input type="email" 
                               x-model="email"
                               @input="validateEmail()"
                               required
                               placeholder="you@example.com"
                               class="w-full bg-transparent border focus:border-aura-dark pl-12 pr-4 py-4 outline-none transition-all duration-300 rounded-sm placeholder-gray-300 text-aura-dark font-medium"
                               :class="(!isEmailValid && email.length > 0) ? 'border-aura-error/50 bg-aura-error/5' : 'border-gray-300'">
                        
                        <i x-show="isEmailValid" class="ph-fill ph-check-circle absolute right-4 top-1/2 -translate-y-1/2 text-aura-success animate-fade-in"></i>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-aura-charcoal/60 mb-2">Password</label>
                    <div class="relative input-group">
                        <i class="ph ph-lock-key absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        
                        <input :type="showPassword ? 'text' : 'password'" 
                               x-model="password"
                               @input="checkPasswordStrength()"
                               required
                               placeholder="••••••••"
                               class="w-full bg-transparent border border-gray-300 focus:border-aura-dark pl-12 pr-12 py-4 outline-none transition-all duration-300 rounded-sm placeholder-gray-300 text-aura-dark font-medium">
                        
                        <button type="button" 
                                @click="showPassword = !showPassword"
                                class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-aura-dark transition p-1 rounded-full hover:bg-gray-100 focus:outline-none">
                            <i :class="showPassword ? 'ph ph-eye-slash' : 'ph ph-eye'" class="text-lg"></i>
                        </button>
                    </div>

                    <div x-show="mode === 'signup'" x-collapse class="mt-3 space-y-2">
                        <div class="flex h-1 w-full bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full strength-bar"
                                 :class="{
                                    'w-0': strength === 0,
                                    'w-1/4 bg-aura-error': strength === 1,
                                    'w-2/4 bg-orange-400': strength === 2,
                                    'w-3/4 bg-yellow-400': strength === 3,
                                    'w-full bg-aura-success': strength === 4
                                 }"></div>
                        </div>
                        <p class="text-[10px] text-gray-500 text-right font-bold" x-text="strengthText"></p>
                    </div>

                    <div class="flex justify-end mt-3" x-show="mode === 'login'">
                        <button type="button" @click="forgotPasswordModal = true" class="text-[10px] text-gray-400 hover:text-aura-accent transition underline decoration-transparent hover:decoration-aura-accent underline-offset-4 focus:outline-none">
                            Forgot Password?
                        </button>
                    </div>
                </div>

                <button type="submit" 
                        :disabled="loading"
                        class="btn-shine w-full bg-aura-dark text-white py-4 text-xs font-bold uppercase tracking-widest hover:bg-aura-forest hover:shadow-xl transition-all duration-300 shadow-lg disabled:opacity-70 disabled:cursor-not-allowed flex justify-center items-center gap-3 rounded-sm transform active:scale-[0.98] mt-8 group"
                        :class="{'animate-shake': shakeButton}">
                    
                    <span x-text="mode === 'login' ? 'SECURE SIGN IN' : 'CREATE ACCOUNT'"></span>
                    
                    <i class="ph ph-arrow-right group-hover:translate-x-1 transition-transform" x-show="!loading"></i>
                </button>

            </form>

            <p class="mt-12 text-center text-[10px] text-gray-400 leading-relaxed max-w-xs mx-auto animate-fade-in" style="animation-delay: 0.3s;">
                By continuing, you acknowledge that you have read and understood our 
                <button @click="termsModal = true" class="underline hover:text-aura-dark transition text-aura-charcoal/70 focus:outline-none">Terms of Service</button> and 
                <button @click="privacyModal = true" class="underline hover:text-aura-dark transition text-aura-charcoal/70 focus:outline-none">Privacy Policy</button>.
            </p>
        </div>
        
        <div class="p-6 text-center lg:text-left border-t border-gray-100 bg-white/50">
            <p class="text-[10px] text-gray-300 uppercase tracking-widest font-bold flex items-center justify-center lg:justify-start gap-2">
                <i class="ph-fill ph-shield-check"></i> &copy; 2026 Aura Apparel. Secure Enclave.
            </p>
        </div>
    </div>

    <template x-if="termsModal || privacyModal || forgotPasswordModal">
        <div class="fixed inset-0 z-[100] flex items-center justify-center p-4">
            
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" 
                 x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                 @click="closeAllModals()"></div>
            
            <div class="relative bg-aura-base w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl rounded-sm flex flex-col"
                 x-transition:enter="ease-out duration-300" 
                 x-transition:enter-start="opacity-0 scale-95 translate-y-4" 
                 x-transition:enter-end="opacity-100 scale-100 translate-y-0">
                
                <div x-show="termsModal" class="flex flex-col h-full">
                    <div class="p-6 border-b border-gray-200 flex justify-between items-center bg-white">
                        <h3 class="font-serif text-2xl text-aura-dark">Terms of Service</h3>
                        <button @click="closeAllModals()" class="hover:text-aura-error transition"><i class="ph ph-x text-2xl"></i></button>
                    </div>
                    <div class="p-8 overflow-y-auto custom-scroll text-sm text-gray-600 leading-relaxed space-y-4">
                        <p class="font-bold text-aura-dark">1. Introduction</p>
                        <p>Welcome to Aura Apparel. By accessing our website, you agree to these terms and conditions in full.</p>
                        <p class="font-bold text-aura-dark">2. Sustainable Sourcing Commitment</p>
                        <p>We guarantee that all materials used are 100% organic and ethically sourced.</p>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-gray-50 flex justify-end">
                        <button @click="closeAllModals()" class="bg-aura-dark text-white px-6 py-2 text-xs font-bold uppercase tracking-widest hover:bg-aura-accent transition rounded-sm shadow-md">I Understand</button>
                    </div>
                </div>

                <div x-show="privacyModal" class="flex flex-col h-full">
                    <div class="p-6 border-b border-gray-200 flex justify-between items-center bg-white">
                        <h3 class="font-serif text-2xl text-aura-dark">Privacy Policy</h3>
                        <button @click="closeAllModals()" class="hover:text-aura-error transition"><i class="ph ph-x text-2xl"></i></button>
                    </div>
                    <div class="p-8 overflow-y-auto custom-scroll text-sm text-gray-600 leading-relaxed space-y-4">
                        <p>At Aura Apparel, we value your privacy. This policy outlines how we handle your data.</p>
                        <ul class="list-disc pl-5 space-y-2 marker:text-aura-accent">
                            <li>We collect only necessary information for order processing.</li>
                            <li>Your payment data is encrypted and never stored on our servers.</li>
                        </ul>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-gray-50 flex justify-end">
                        <button @click="closeAllModals()" class="bg-aura-dark text-white px-6 py-2 text-xs font-bold uppercase tracking-widest hover:bg-aura-accent transition rounded-sm shadow-md">Close</button>
                    </div>
                </div>

                <div x-show="forgotPasswordModal" class="flex flex-col h-full">
                    <div class="p-6 border-b border-gray-200 flex justify-between items-center bg-white">
                        <h3 class="font-serif text-2xl text-aura-dark">Reset Password</h3>
                        <button @click="closeAllModals()" class="hover:text-aura-error transition"><i class="ph ph-x text-2xl"></i></button>
                    </div>
                    <div class="p-8">
                        <p class="text-sm text-gray-600 mb-6">Enter the email address associated with your account and we'll send you a secure link to reset your password.</p>
                        <div class="relative group">
                            <i class="ph ph-envelope absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="email" placeholder="you@example.com" class="w-full bg-white border border-gray-300 focus:border-aura-dark pl-12 pr-4 py-3 outline-none transition rounded-sm">
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-gray-50 flex justify-end gap-3">
                        <button @click="closeAllModals()" class="px-6 py-2 text-xs font-bold uppercase tracking-widest hover:text-aura-dark text-gray-500 transition">Cancel</button>
                        <button @click="closeAllModals(); $dispatch('notify', {title: 'Email Sent', message: 'If an account exists, you will receive a reset link.'})" class="bg-aura-dark text-white px-6 py-2 text-xs font-bold uppercase tracking-widest hover:bg-aura-accent transition rounded-sm shadow-md">Send Reset Link</button>
                    </div>
                </div>

            </div>
        </div>
    </template>

    <script>
        // 1. SUPABASE INITIALIZATION
        const SUPABASE_URL = 'https://xenosyklkpisszqwibdw.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhlbm9zeWtsa3Bpc3N6cXdpYmR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTkxNzcsImV4cCI6MjA4NjQzNTE3N30.A_WVC9GRa7USe2DPbzVUWw3TuBHnyImVqBZnzuPJbMw';
        
        let supabase;
        try {
            // Ensure supabase client is available
            if (window.supabase && window.supabase.createClient) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log("Aura Secure System: Online");
            } else {
                console.error("Supabase library not loaded.");
            }
        } catch (err) {
            console.error('Critical System Failure:', err);
        }

        // 2. PARTICLE ENGINE CLASS
        class ParticleEngine {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                if (!this.canvas) return;
                
                this.ctx = this.canvas.getContext('2d');
                this.width = 0;
                this.height = 0;
                this.particles = [];
                this.mouse = { x: null, y: null };
                this.config = {
                    count: 60,
                    connDist: 150,
                    mouseDist: 200,
                    color: 'rgba(197, 160, 101, ' 
                };

                this.bindEvents();
                this.resize();
                this.init();
                this.animate();
            }

            bindEvents() {
                window.addEventListener('resize', () => {
                    this.resize();
                    this.init();
                });
                
                window.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = e.clientX - rect.left;
                    this.mouse.y = e.clientY - rect.top;
                });

                window.addEventListener('mouseleave', () => {
                    this.mouse.x = null;
                    this.mouse.y = null;
                });
            }

            resize() {
                this.width = this.canvas.width = this.canvas.parentElement.offsetWidth;
                this.height = this.canvas.height = this.canvas.parentElement.offsetHeight;
            }

            init() {
                this.particles = [];
                for (let i = 0; i < this.config.count; i++) {
                    this.particles.push({
                        x: Math.random() * this.width,
                        y: Math.random() * this.height,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        size: Math.random() * 2 + 1
                    });
                }
            }

            animate() {
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                for (let i = 0; i < this.particles.length; i++) {
                    let p = this.particles[i];
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > this.width) p.vx *= -1;
                    if (p.y < 0 || p.y > this.height) p.vy *= -1;

                    if (this.mouse.x != null) {
                        let dx = this.mouse.x - p.x;
                        let dy = this.mouse.y - p.y;
                        let dist = Math.sqrt(dx*dx + dy*dy);
                        if (dist < this.config.mouseDist) {
                            const force = (this.config.mouseDist - dist) / this.config.mouseDist;
                            p.x -= (dx / dist) * force * 0.6;
                            p.y -= (dy / dist) * force * 0.6;
                        }
                    }

                    this.ctx.fillStyle = this.config.color + '0.5)';
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    this.ctx.fill();

                    for (let j = i; j < this.particles.length; j++) {
                        let p2 = this.particles[j];
                        let dx = p.x - p2.x;
                        let dy = p.y - p2.y;
                        let dist = Math.sqrt(dx*dx + dy*dy);

                        if (dist < this.config.connDist) {
                            this.ctx.beginPath();
                            let opacity = 1 - (dist / this.config.connDist);
                            this.ctx.strokeStyle = this.config.color + (opacity * 0.2) + ')';
                            this.ctx.lineWidth = 1;
                            this.ctx.moveTo(p.x, p.y);
                            this.ctx.lineTo(p2.x, p2.y);
                            this.ctx.stroke();
                        }
                    }
                }
                requestAnimationFrame(this.animate.bind(this));
            }
        }

        // 3. MAIN APPLICATION STATE
        function authApp() {
            return {
                mode: 'login', 
                email: '',
                password: '',
                showPassword: false,
                loading: false,
                loadingText: 'Authenticating...',
                shakeButton: false, 
                toasts: [],
                
                isEmailValid: false,
                strength: 0,
                strengthText: '',

                termsModal: false,
                privacyModal: false,
                forgotPasswordModal: false,

                init() {
                    // Start Particle Engine
                    this.$nextTick(() => {
                        try {
                            new ParticleEngine('particle-canvas');
                        } catch(e) { console.warn('Particle engine skipped'); }
                    });

                    // Listen for global notification events
                    window.addEventListener('notify', (e) => {
                        this.showToast(e.detail.title, e.detail.message);
                    });
                },

                switchMode(newMode) {
                    this.mode = newMode;
                    this.shakeButton = false;
                },

                closeAllModals() {
                    this.termsModal = false;
                    this.privacyModal = false;
                    this.forgotPasswordModal = false;
                },

                validateEmail() {
                    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    this.isEmailValid = re.test(this.email);
                },

                checkPasswordStrength() {
                    if (this.mode !== 'signup') return;
                    let score = 0;
                    if (this.password.length > 6) score++;
                    if (this.password.length > 10) score++;
                    if (/[A-Z]/.test(this.password)) score++;
                    if (/[0-9]/.test(this.password)) score++;
                    this.strength = Math.min(score, 4);
                    const texts = ['Too Weak', 'Weak', 'Fair', 'Good', 'Strong'];
                    this.strengthText = texts[this.strength];
                },

                async handleSubmit() {
                    console.log("Submit triggered. Mode:", this.mode);
                    this.shakeButton = false;

                    // Validation
                    if (!this.email || !this.password) {
                        this.triggerError('Missing Fields', 'Please fill in all required fields.');
                        return;
                    }

                    if (this.mode === 'signup' && this.strength < 2) {
                        this.triggerError('Password too weak', 'Please use a stronger password.');
                        return;
                    }

                    this.loading = true;
                    this.loadingText = this.mode === 'login' ? 'Verifying Credentials...' : 'Creating Account...';

                    try {
                        if (!supabase) throw new Error("Connection to secure servers failed.");

                        let result;
                        if (this.mode === 'signup') {
                            result = await supabase.auth.signUp({
                                email: this.email,
                                password: this.password,
                                options: {
                                    data: { agreed_to_terms: true }
                                }
                            });
                        } else {
                            result = await supabase.auth.signInWithPassword({
                                email: this.email,
                                password: this.password,
                            });
                        }

                        if (result.error) throw result.error;

                        // Handle Success
                        if (this.mode === 'signup') {
                            if (result.data.user && !result.data.session) {
                                this.showToast('Check your email', 'We sent a confirmation link.', 'success');
                                this.loading = false;
                            } else {
                                this.showToast('Success', 'Account created. Redirecting...', 'success');
                                setTimeout(() => window.location.href = 'index.html', 1500);
                            }
                        } else {
                            this.showToast('Welcome Back', 'Access granted.', 'success');
                            setTimeout(() => window.location.href = 'index.html', 1000);
                        }

                    } catch (err) {
                        console.error('Auth Error:', err);
                        this.triggerError('Authentication Failed', err.message || "Unknown error occurred.");
                        this.loading = false;
                    }
                },

                triggerError(title, message) {
                    this.showToast(title, message, 'error');
                    this.shakeButton = true;
                    setTimeout(() => this.shakeButton = false, 500);
                },

                showToast(title, message, type = 'success') {
                    const id = Date.now();
                    this.toasts.push({ id, title, message, type, visible: true });
                    setTimeout(() => this.removeToast(id), 5000);
                },

                removeToast(id) {
                    const index = this.toasts.findIndex(t => t.id === id);
                    if (index > -1) {
                        this.toasts[index].visible = false;
                        setTimeout(() => {
                            this.toasts = this.toasts.filter(t => t.id !== id);
                        }, 300);
                    }
                }
            }
        }
    </script>
</body>
</html>
