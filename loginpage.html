<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA | Access The Inner Circle</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        aura: { base: '#F9F7F2', dark: '#0e231f', forest: '#15302a', charcoal: '#2D2D2D', accent: '#C5A065', error: '#9B2C2C', success: '#2F855A' }
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
        .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>
</head>

<body class="bg-aura-base text-aura-charcoal antialiased min-h-screen flex flex-col items-center justify-center p-6" x-data="authApp()" x-init="checkConnection()">

    <div class="fixed top-4 left-4 flex items-center gap-2 px-3 py-1.5 rounded-full text-[10px] font-bold tracking-widest uppercase border"
         :class="connectionStatus === 'online' ? 'bg-green-100 text-green-700 border-green-200' : 'bg-red-100 text-red-700 border-red-200'">
        <div class="w-2 h-2 rounded-full animate-pulse" :class="connectionStatus === 'online' ? 'bg-green-500' : 'bg-red-500'"></div>
        Supabase: <span x-text="connectionStatus"></span>
    </div>

    <div class="fixed top-6 right-6 z-[70] flex flex-col gap-3 pointer-events-none">
        <template x-for="toast in toasts" :key="toast.id">
            <div x-show="toast.visible" x-transition class="px-6 py-5 rounded shadow-2xl bg-white border-l-4 pointer-events-auto min-w-[300px]"
                 :class="toast.type === 'error' ? 'text-aura-error border-aura-error' : 'text-aura-dark border-aura-accent'">
                <p class="text-xs font-bold uppercase tracking-widest mb-1" x-text="toast.title"></p>
                <p class="text-xs opacity-80" x-text="toast.message"></p>
            </div>
        </template>
    </div>

    <div class="w-full max-w-sm bg-white p-10 rounded-sm shadow-sm border border-gray-100">
        <div class="text-center mb-10">
            <h1 class="text-3xl font-serif font-bold tracking-[0.2em] uppercase text-aura-dark">AURA<span class="text-aura-accent">.</span></h1>
            <p class="text-[10px] text-gray-400 mt-2 uppercase tracking-widest">Secure Access</p>
        </div>

        <div class="flex border-b mb-8">
            <button @click="mode = 'login'" class="flex-1 pb-4 text-[10px] font-bold uppercase tracking-widest" :class="mode === 'login' ? 'text-aura-dark border-b-2 border-aura-dark' : 'text-gray-300'">Login</button>
            <button @click="mode = 'signup'" class="flex-1 pb-4 text-[10px] font-bold uppercase tracking-widest" :class="mode === 'signup' ? 'text-aura-dark border-b-2 border-aura-dark' : 'text-gray-300'">Register</button>
        </div>

        <form @submit.prevent="handleSubmit" class="space-y-6">
            <div>
                <input type="email" x-model="email" placeholder="Email" required class="w-full border-b border-gray-200 py-3 outline-none focus:border-aura-dark text-sm transition-all">
            </div>
            <div>
                <input type="password" x-model="password" placeholder="Password" required class="w-full border-b border-gray-200 py-3 outline-none focus:border-aura-dark text-sm transition-all">
            </div>
            <button type="submit" :disabled="loading" 
                    class="w-full bg-aura-dark text-white py-4 text-[10px] font-bold uppercase tracking-[0.2em] hover:bg-aura-forest transition-all disabled:opacity-50"
                    :class="{'animate-shake': shakeButton}">
                <span x-text="loading ? 'Processing...' : (mode === 'login' ? 'Sign In' : 'Create Account')"></span>
            </button>
        </form>
    </div>

    <script>
        const S_URL = 'https://xenosyklkpisszqwibdw.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhlbm9zeWtsa3Bpc3N6cXdpYmR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTkxNzcsImV4cCI6MjA4NjQzNTE3N30.A_WVC9GRa7USe2DPbzVUWw3TuBHnyImVqBZnzuPJbMw';
        
        let sb;

        function authApp() {
            return {
                mode: 'login',
                email: '',
                password: '',
                loading: false,
                shakeButton: false,
                connectionStatus: 'checking...',
                toasts: [],

                checkConnection() {
                    console.log("Checking Supabase Connection...");
                    try {
                        if (typeof supabase !== 'undefined') {
                            sb = supabase.createClient(S_URL, S_KEY);
                            this.connectionStatus = 'online';
                            console.log("✔ Supabase Client Ready");
                        } else {
                            this.connectionStatus = 'offline';
                            this.showToast("Library Error", "Gagal memuat script Supabase. Cek internet/Ad-blocker.", "error");
                        }
                    } catch (e) {
                        this.connectionStatus = 'error';
                        console.error(e);
                    }
                },

                async handleSubmit() {
                    if (!sb) {
                        this.showToast("Koneksi Gagal", "Supabase belum terhubung.", "error");
                        return;
                    }

                    this.loading = true;
                    this.shakeButton = false;

                    try {
                        console.log(`Attempting ${this.mode} for: ${this.email}`);
                        
                        let res;
                        if (this.mode === 'signup') {
                            res = await sb.auth.signUp({ 
                                email: this.email, 
                                password: this.password,
                                options: { emailRedirectTo: window.location.origin }
                            });
                        } else {
                            res = await sb.auth.signInWithPassword({ email: this.email, password: this.password });
                        }

                        if (res.error) throw res.error;

                        console.log("✔ Success:", res.data);
                        this.showToast("Success", "Silahkan cek Dashboard atau Email Anda!", "success");

                    } catch (err) {
                        console.error("❌ Supabase Error:", err);
                        this.showToast("Gagal", err.message, "error");
                        this.shakeButton = true;
                    } finally {
                        this.loading = false;
                    }
                },

                showToast(title, message, type) {
                    const id = Date.now();
                    this.toasts.push({ id, title, message, type, visible: true });
                    setTimeout(() => this.toasts = this.toasts.filter(t => t.id !== id), 5000);
                }
            }
        }
    </script>
</body>
</html>
