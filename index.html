<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA APPAREL | Premium Sustainable Fashion Indonesia</title>
    <meta name="description" content="Indonesian sustainable clothing brand. Handcrafted, organic, and ethical fashion from Java.">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        aura: {
                            base: '#F9F7F2',
                            dark: '#15302a',
                            charcoal: '#2D2D2D',
                            accent: '#C5A065',
                            sand: '#E6E2DD',
                            terra: '#B08E77',
                            error: '#9B2C2C',
                            success: '#2F855A'
                        }
                    },
                    fontFamily: {
                        sans: ['Lato', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
        .glass-nav {
            background: rgba(249, 247, 242, 0.90);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(21, 48, 42, 0.05);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-left-color: #C5A065;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>

<body class="bg-aura-base text-aura-charcoal antialiased selection:bg-aura-dark selection:text-aura-accent"
      x-data="shopApp()">

    <div class="fixed top-24 right-5 z-50 flex flex-col gap-2 pointer-events-none">
        <template x-for="toast in toasts" :key="toast.id">
            <div x-show="toast.visible" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-x-8"
                 x-transition:enter-end="opacity-100 translate-x-0"
                 x-transition:leave="transition ease-in duration-300"
                 x-transition:leave-start="opacity-100 translate-x-0"
                 x-transition:leave-end="opacity-0 translate-x-8"
                 class="bg-aura-dark text-white px-6 py-4 rounded shadow-2xl flex items-center gap-4 min-w-[300px] pointer-events-auto border-l-4 border-aura-accent">
                <i class="ph-fill ph-check-circle text-aura-accent text-xl"></i>
                <div>
                    <h4 class="font-bold text-xs uppercase tracking-wider" x-text="toast.title || 'Notification'"></h4>
                    <p class="text-xs text-white/80" x-text="toast.message"></p>
                </div>
            </div>
        </template>
    </div>

    <div x-show="session" x-cloak
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-8"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="fixed bottom-6 left-6 z-40 flex items-center gap-3">
        <div class="glass-card p-4 rounded-lg flex items-center gap-4 text-aura-dark">
            <div class="w-10 h-10 bg-aura-dark text-aura-accent rounded-full flex items-center justify-center text-lg font-bold">
                <span x-text="userInitials"></span>
            </div>
            <div>
                <p class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">Logged in as</p>
                <p class="text-xs font-serif font-bold truncate max-w-[120px]" x-text="session?.user?.email"></p>
            </div>
            <div class="h-8 w-px bg-gray-200 mx-1"></div>
            <button @click="handleLogout" class="text-aura-error hover:text-red-700 transition" title="Sign Out">
                <i class="ph ph-sign-out text-xl"></i>
            </button>
        </div>
    </div>

    <header class="fixed top-0 w-full z-40 transition-all duration-500 ease-in-out"
            :class="scrolled ? 'glass-nav text-aura-dark' : 'bg-transparent py-8 text-white'">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center gap-4 w-1/3">
                <button @click="mobileMenuOpen = true" class="lg:hidden hover:text-aura-accent transition p-2 -ml-2">
                    <i class="ph ph-list text-2xl"></i>
                </button>
                <button class="hidden lg:flex items-center gap-2 hover:text-aura-accent transition group">
                    <i class="ph ph-magnifying-glass text-xl"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all -translate-x-2 group-hover:translate-x-0">Search</span>
                </button>
            </div>
            <div class="w-1/3 text-center">
                <a href="#" class="inline-block group">
                    <h1 class="text-2xl md:text-3xl font-serif font-bold tracking-[0.2em] uppercase transition-colors group-hover:text-aura-accent">
                        Aura<span class="text-aura-accent group-hover:text-current">.</span>
                    </h1>
                </a>
            </div>
            <div class="flex items-center justify-end gap-6 w-1/3">
                <nav class="hidden lg:flex gap-8 text-[11px] font-bold tracking-widest uppercase">
                    <a href="#shop" class="hover:text-aura-accent transition relative group">Shop</a>
                    <a href="#about" class="hover:text-aura-accent transition relative group">Sustainability</a>
                </nav>
                <div class="h-4 w-px bg-current opacity-20 hidden lg:block"></div>
                <a href="loginpage.html" x-show="!session" class="hidden lg:block hover:text-aura-accent transition" title="Login">
                    <i class="ph ph-user text-xl"></i>
                </a>
                <button @click="cartOpen = true" class="relative hover:text-aura-accent transition p-1">
                    <i class="ph ph-tote text-xl"></i>
                    <span x-show="cartCount > 0" x-cloak class="absolute -top-1 -right-1 bg-aura-accent text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold shadow-sm" x-text="cartCount"></span>
                </button>
            </div>
        </div>
    </header>

    <section class="relative h-screen w-full overflow-hidden flex items-center justify-center">
        <div class="absolute inset-0 z-0">
            <img src="https://images.unsplash.com/photo-1523381210434-271e8be1f52b?q=80&w=2000" 
                 alt="Aura Apparel Hero" 
                 class="w-full h-full object-cover object-center animate-pulse-slow scale-105">
            <div class="absolute inset-0 bg-gradient-to-b from-black/50 via-black/20 to-black/70"></div>
        </div>
        <div class="relative z-10 text-center text-white px-4 max-w-5xl mt-10">
            <div class="overflow-hidden mb-6">
                <span class="inline-block text-aura-accent font-bold tracking-[0.3em] uppercase text-[10px] md:text-xs animate-fade-in-up border border-aura-accent/30 px-4 py-2 rounded-full glass-panel">
                    Summer Collection 2026
                </span>
            </div>
            <h2 class="text-5xl md:text-7xl lg:text-9xl font-serif font-medium leading-[0.9] mb-8 text-shadow-sm animate-fade-in-up" style="animation-delay: 0.2s;">
                Ethical Luxury <br><span class="italic font-light text-white/90">From Java.</span>
            </h2>
            <div class="flex flex-col sm:flex-row gap-5 justify-center animate-fade-in-up" style="animation-delay: 0.6s;">
                <a href="#shop" class="bg-white text-aura-dark px-12 py-4 uppercase text-xs font-bold tracking-widest hover:bg-aura-accent hover:text-white transition duration-300 shadow-xl rounded-sm">
                    Shop Collection
                </a>
            </div>
        </div>
    </section>

    <main id="shop" class="bg-aura-base pt-24 pb-32">
        <div class="container mx-auto px-6">
            
            <div class="flex flex-col md:flex-row justify-between items-end mb-16 border-b border-aura-dark/10 pb-8">
                <div>
                    <h2 class="text-4xl md:text-5xl font-serif text-aura-dark mb-4">The Essentials</h2>
                    <p class="text-aura-charcoal/60 max-w-md font-light">Timeless pieces designed to be worn on repeat. Built to last, made to love.</p>
                </div>
                <div class="mt-6 md:mt-0">
                    <a href="catalog.html" class="text-aura-accent font-bold uppercase tracking-widest text-xs border-b border-aura-accent pb-1 hover:text-aura-dark transition">
                        View Full Catalog
                    </a>
                </div>
            </div>

            <div x-show="productsLoading" class="flex flex-col items-center justify-center py-20 text-gray-400">
                <div class="spinner border-aura-dark mb-4"></div>
                <p class="text-xs uppercase tracking-widest">Loading Collection...</p>
            </div>

            <div x-show="!productsLoading && products.length === 0" class="text-center py-20 bg-gray-50 rounded border border-gray-100" x-cloak>
                <p class="text-gray-500 font-serif text-lg mb-2">No products found.</p>
                <p class="text-xs text-gray-400">Please add products via the Admin Dashboard.</p>
            </div>

            <div x-show="!productsLoading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-16">
                <template x-for="product in products" :key="product.id">
                    <div class="group relative">
                        <div class="relative overflow-hidden bg-gray-200 aspect-[3/4] mb-6">
                            <img :src="product.image" :alt="product.name" class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110">
                            
                            <div class="absolute top-4 left-4 flex flex-col gap-2">
                                <span x-show="product.badge" class="bg-white/95 backdrop-blur text-aura-dark text-[10px] font-bold uppercase tracking-widest px-3 py-1 shadow-sm" x-text="product.badge"></span>
                                <span x-show="product.is_new" class="bg-aura-dark text-white text-[10px] font-bold uppercase tracking-widest px-3 py-1 w-max shadow-sm">New</span>
                            </div>

                            <div class="absolute inset-x-0 bottom-0 p-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 bg-gradient-to-t from-black/80 to-transparent">
                                <div class="bg-white p-4 shadow-lg">
                                    <p class="text-[10px] uppercase font-bold text-gray-400 mb-2">Select Size</p>
                                    <div class="flex justify-between gap-2 mb-3">
                                        <template x-for="size in ['S', 'M', 'L']">
                                            <button @click="addToCart(product, size)" 
                                                    class="flex-1 border border-gray-200 hover:border-aura-dark hover:bg-aura-dark hover:text-white py-2 text-xs font-bold transition">
                                                <span x-text="size"></span>
                                            </button>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-serif text-lg text-aura-dark group-hover:text-aura-accent transition-colors cursor-pointer" x-text="product.name"></h3>
                                <p class="text-[11px] text-gray-500 mt-1 uppercase tracking-wide" x-text="product.category"></p>
                            </div>
                            <span class="font-bold text-aura-dark text-sm font-serif" x-text="formatMoney(product.price)"></span>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </main>

    <footer class="bg-[#0e231f] text-white pt-24 pb-12 border-t border-white/5">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-20">
                <div>
                    <a href="#" class="text-3xl font-serif font-bold tracking-widest text-white mb-6 block">AURA.</a>
                    <p class="text-white/50 text-sm leading-relaxed mb-8">
                        Redefining Indonesian fashion through sustainability and timeless design. Proudly made in Java.
                    </p>
                </div>
                <div>
                    <h4 class="uppercase tracking-widest text-xs font-bold mb-8 text-aura-accent border-b border-white/10 pb-2 inline-block">Collections</h4>
                    <ul class="space-y-4 text-sm text-white/60">
                        <li><a href="#" class="hover:text-white transition flex items-center gap-2 group"><i class="ph ph-caret-right text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>New Arrivals</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="uppercase tracking-widest text-xs font-bold mb-8 text-aura-accent border-b border-white/10 pb-2 inline-block">Help & Info</h4>
                    <ul class="space-y-4 text-sm text-white/60">
                        <li><a href="#" class="hover:text-white transition flex items-center gap-2 group"><i class="ph ph-caret-right text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>Contact Us</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="uppercase tracking-widest text-xs font-bold mb-8 text-aura-accent border-b border-white/10 pb-2 inline-block">Studio</h4>
                    <ul class="space-y-6 text-sm text-white/60">
                        <li class="flex items-start gap-4">
                            <i class="ph ph-map-pin text-xl text-aura-accent mt-0.5"></i>
                            <span>Jl. Senopati No. 45,<br>Jakarta Selatan 12190</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-white/5 pt-8 flex flex-col md:flex-row justify-between items-center text-[10px] text-white/30 uppercase tracking-widest">
                <p>&copy; 2026 Aura Apparel Indonesia.</p>
            </div>
        </div>
    </footer>

    <div class="relative z-50" aria-labelledby="slide-over-title" role="dialog" aria-modal="true" x-show="cartOpen" x-cloak>
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity" 
             x-show="cartOpen"
             x-transition:enter="ease-in-out duration-500"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="ease-in-out duration-500"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             @click="cartOpen = false"></div>

        <div class="fixed inset-0 overflow-hidden">
            <div class="absolute inset-0 overflow-hidden">
                <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 sm:pl-10">
                    <div class="pointer-events-auto w-screen max-w-md transform transition ease-in-out duration-500"
                         x-show="cartOpen"
                         x-transition:enter="translate-x-full"
                         x-transition:enter-end="translate-x-0"
                         x-transition:leave="translate-x-0"
                         x-transition:leave-end="translate-x-full">
                        <div class="flex h-full flex-col bg-white shadow-2xl">
                            <div class="flex items-start justify-between px-4 py-6 sm:px-6 border-b border-gray-100 bg-aura-base">
                                <h2 class="text-xl font-serif text-aura-dark font-bold">Shopping Bag</h2>
                                <button type="button" class="text-gray-400 hover:text-aura-error transition p-2" @click="cartOpen = false">
                                    <span class="sr-only">Close panel</span><i class="ph ph-x text-2xl"></i>
                                </button>
                            </div>

                            <div class="flex-1 overflow-y-auto px-4 py-6 sm:px-6 relative">
                                <div x-show="cartLoading" class="absolute inset-0 bg-white/50 backdrop-blur-sm z-10 flex items-center justify-center">
                                    <div class="spinner border-aura-dark" style="border-left-color: #15302a;"></div>
                                </div>

                                <div class="flow-root">
                                    <ul role="list" class="-my-6 divide-y divide-gray-100">
                                        <template x-show="cart.length === 0 && !cartLoading">
                                            <div class="h-full flex flex-col items-center justify-center text-center mt-20 opacity-50">
                                                <i class="ph ph-tote text-6xl mb-4 text-aura-dark"></i>
                                                <p class="text-gray-500 font-serif text-lg">Your bag is empty.</p>
                                                <button @click="cartOpen = false" class="mt-4 text-xs font-bold uppercase tracking-widest text-aura-accent hover:text-aura-dark underline">Start Shopping</button>
                                            </div>
                                        </template>
                                        <template x-for="(item, index) in cart" :key="index">
                                            <li class="flex py-6">
                                                <div class="h-24 w-20 flex-shrink-0 overflow-hidden border border-gray-200 rounded-sm">
                                                    <img :src="item.image" class="h-full w-full object-cover object-center">
                                                </div>
                                                <div class="ml-4 flex flex-1 flex-col">
                                                    <div>
                                                        <div class="flex justify-between text-base font-medium text-aura-dark">
                                                            <h3 x-text="item.name" class="font-serif pr-4"></h3>
                                                            <p class="whitespace-nowrap" x-text="formatMoney(item.price)"></p>
                                                        </div>
                                                        <p class="mt-1 text-xs text-aura-dark font-bold">Size: <span x-text="item.size" class="text-aura-accent"></span></p>
                                                    </div>
                                                    <div class="flex flex-1 items-end justify-between text-sm">
                                                        <p class="text-gray-500 text-xs">Qty <span x-text="item.quantity"></span></p>
                                                        <button type="button" @click="removeFromCart(index, item)" class="font-bold text-aura-error/70 hover:text-aura-error text-[10px] uppercase tracking-wider transition">Remove</button>
                                                    </div>
                                                </div>
                                            </li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                            <div class="border-t border-gray-100 px-4 py-6 sm:px-6 bg-aura-base/30">
                                <div class="flex justify-between text-base font-medium text-aura-dark mb-4">
                                    <p class="font-serif font-bold">Subtotal</p>
                                    <p class="font-bold" x-text="formatMoney(cartTotal)"></p>
                                </div>
                                <div class="mt-6">
                                    <a href="checkout.html" class="flex items-center justify-center rounded-sm border border-transparent bg-aura-dark px-6 py-4 text-base font-medium text-white shadow-sm hover:bg-aura-accent hover:text-aura-dark transition uppercase tracking-widest text-xs font-bold duration-300">
                                        Proceed to Checkout
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div x-show="mobileMenuOpen" class="fixed inset-0 z-50 flex lg:hidden" x-cloak>
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="mobileMenuOpen = false"></div>
        <div class="relative bg-aura-base w-4/5 max-w-sm h-full shadow-2xl p-8 flex flex-col">
            <button @click="mobileMenuOpen = false" class="absolute top-8 right-8"><i class="ph ph-x text-2xl text-aura-dark"></i></button>
            <nav class="flex flex-col space-y-6 text-xl font-serif text-aura-dark mt-12">
                <a href="#shop" class="border-b border-aura-dark/10 pb-4">Shop</a>
                <a href="#about" class="border-b border-aura-dark/10 pb-4">Sustainability</a>
                <a href="catalog.html" class="border-b border-aura-dark/10 pb-4 text-aura-accent">Full Catalog</a>
                <div x-show="!session">
                    <a href="loginpage.html" class="block w-full text-center bg-aura-dark text-white py-4 text-xs font-bold uppercase tracking-widest rounded-sm mt-8">Login</a>
                </div>
                <div x-show="session">
                    <button @click="handleLogout" class="block w-full text-center border border-aura-error text-aura-error py-4 text-xs font-bold uppercase tracking-widest rounded-sm mt-8">Sign Out</button>
                </div>
            </nav>
        </div>
    </div>

    <script>
        function shopApp() {
            return {
                supabase: null,
                session: null,
                
                // UI States
                scrolled: false,
                mobileMenuOpen: false,
                cartOpen: false,
                cartLoading: false,
                productsLoading: true, 
                
                // Data
                products: [], 
                cart: [],
                toasts: [],

                get cartTotal() { return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0); },
                get cartCount() { return this.cart.reduce((total, item) => total + item.quantity, 0); },
                get userInitials() { return this.session?.user?.email ? this.session.user.email.substring(0, 2).toUpperCase() : 'U'; },

                init() {
                    window.addEventListener('scroll', () => { this.scrolled = window.scrollY > 20; });
                    this.initSupabase();
                },

                async initSupabase() {
                    const sbUrl = 'https://xenosyklkpisszqwibdw.supabase.co';
                    const sbKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhlbm9zeWtsa3Bpc3N6cXdpYmR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTkxNzcsImV4cCI6MjA4NjQzNTE3N30.A_WVC9GRa7USe2DPbzVUWw3TuBHnyImVqBZnzuPJbMw';
                    
                    if (typeof supabase !== 'undefined') {
                        this.supabase = supabase.createClient(sbUrl, sbKey);
                        
                        // 1. Fetch Products FIRST
                        await this.fetchProducts();

                        // 2. Check Auth
                        const { data: { session } } = await this.supabase.auth.getSession();
                        this.handleSessionChange(session);
                        this.supabase.auth.onAuthStateChange((_event, session) => this.handleSessionChange(session));
                    }
                },

                // Fetch Products from Supabase DB
                async fetchProducts() {
                    this.productsLoading = true;
                    try {
                        const { data, error } = await this.supabase
                            .from('products')
                            .select('*')
                            .order('created_at', { ascending: false })
                            .limit(8); 
                        
                        if (error) throw error;
                        this.products = data;
                    } catch (e) {
                        console.error('Error loading products:', e);
                        this.showToast('Failed to load products', 'Error', 'error');
                    } finally {
                        this.productsLoading = false;
                    }
                },

                async handleSessionChange(session) {
                    this.session = session;
                    if (session) {
                        await this.syncGuestCartToCloud();
                        await this.fetchCloudCart();
                    } else {
                        this.loadLocalCart();
                    }
                },

                /* CART LOGIC */
                async addToCart(product, size) {
                    this.cartOpen = true; 
                    if (!this.session) this.addToLocalCart(product, size);
                    else await this.addToCloudCart(product, size);
                },

                addToLocalCart(product, size) {
                    const existingItem = this.cart.find(i => i.id === product.id && i.size === size);
                    if (existingItem) existingItem.quantity++;
                    else {
                        const item = JSON.parse(JSON.stringify(product));
                        item.size = size;
                        item.quantity = 1;
                        this.cart.push(item);
                    }
                    this.saveLocalCart();
                    this.showToast(`${product.name} added.`);
                },

                async addToCloudCart(product, size) {
                    this.cartLoading = true;
                    try {
                        const existingItem = this.cart.find(i => i.id === product.id && i.size === size);
                        const newQty = existingItem ? existingItem.quantity + 1 : 1;

                        const { error } = await this.supabase
                            .from('cart_items')
                            .upsert({ 
                                user_id: this.session.user.id,
                                product_id: product.id, 
                                size: size,
                                quantity: newQty
                            }, { onConflict: 'user_id, product_id, size' });

                        if (error) throw error;
                        await this.fetchCloudCart();
                        this.showToast(`${product.name} saved.`);
                    } catch (e) {
                        console.error('Cart Error:', e);
                    } finally {
                        this.cartLoading = false;
                    }
                },

                async removeFromCart(index, item) {
                    if (!this.session) {
                        this.cart.splice(index, 1);
                        this.saveLocalCart();
                    } else {
                        this.cartLoading = true;
                        try {
                            const { error } = await this.supabase.from('cart_items').delete().match({ user_id: this.session.user.id, product_id: item.id, size: item.size });
                            if (error) throw error;
                            this.cart.splice(index, 1);
                        } catch (e) { console.error('Delete Error:', e); } finally { this.cartLoading = false; }
                    }
                },

                async fetchCloudCart() {
                    this.cartLoading = true;
                    try {
                        const { data, error } = await this.supabase.from('cart_items').select('*');
                        if (error) throw error;
                        
                        this.cart = data.map(row => {
                            const productInfo = this.products.find(p => p.id === row.product_id);
                            if (!productInfo) return null; 
                            return { ...productInfo, size: row.size, quantity: row.quantity };
                        }).filter(Boolean);
                    } catch (e) { console.error('Fetch Error:', e); } finally { this.cartLoading = false; }
                },

                saveLocalCart() { localStorage.setItem('aura_cart_guest', JSON.stringify(this.cart)); },
                loadLocalCart() { const stored = localStorage.getItem('aura_cart_guest'); if (stored) this.cart = JSON.parse(stored); },
                async syncGuestCartToCloud() {
                    const guestCart = JSON.parse(localStorage.getItem('aura_cart_guest') || '[]');
                    if (guestCart.length > 0) {
                        for (const item of guestCart) await this.addToCloudCart(item, item.size);
                        localStorage.removeItem('aura_cart_guest');
                    }
                },
                
                showToast(message, title = 'Notification', type = 'success') {
                    const id = Date.now();
                    this.toasts.push({ id, message, title, type, visible: true });
                    setTimeout(() => {
                        const index = this.toasts.findIndex(t => t.id === id);
                        if (index > -1) this.toasts[index].visible = false;
                        setTimeout(() => this.toasts = this.toasts.filter(t => t.id !== id), 300);
                    }, 3000);
                },
                async handleLogout() { if (this.supabase) { await this.supabase.auth.signOut(); this.cart = []; } },
                formatMoney(amount) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumSignificantDigits: 9 }).format(amount); }
            }
        }
    </script>
</body>
</html>
