<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA APPAREL | Premium Sustainable Fashion Indonesia</title>
    <meta name="description" content="Indonesian sustainable clothing brand. Handcrafted, organic, and ethical fashion from Java.">
    <link rel="icon" type="image/png" href="https://fav.farm/âœ¨">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        aura: {
                            base: '#F9F7F2',       /* Off-white background */
                            dark: '#15302a',       /* Deep Jungle Green */
                            charcoal: '#2D2D2D',   /* Soft Black */
                            accent: '#C5A065',     /* Gold/Sand Accent */
                            sand: '#E6E2DD',       /* Light Beige */
                            terra: '#B08E77',      /* Earthy Brown */
                            error: '#9B2C2C',      /* Red for errors */
                            success: '#2F855A'     /* Green for success */
                        }
                    },
                    fontFamily: {
                        sans: ['Lato', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 1s ease-out forwards',
                        'slide-up': 'slideUp 0.8s ease-out forwards',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(40px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Hide Alpine elements before they load to prevent "fouc" */
        [x-cloak] { display: none !important; }
        
        /* Smooth Scrolling */
        html { scroll-behavior: smooth; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F9F7F2; 
        }
        ::-webkit-scrollbar-thumb {
            background: #C5A065; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #15302a; 
        }

        /* Glassmorphism Classes */
        .glass-nav {
            background: rgba(249, 247, 242, 0.90);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(21, 48, 42, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(21, 48, 42, 0.1);
            border-left-color: #C5A065;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Typography Utilities */
        .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .text-shadow-lg { text-shadow: 0 4px 8px rgba(0,0,0,0.5); }
    </style>
</head>

<body class="bg-aura-base text-aura-charcoal antialiased selection:bg-aura-dark selection:text-aura-accent"
      x-data="shopApp()"
      x-init="init()">

    <div class="fixed top-24 right-5 z-[100] flex flex-col gap-3 pointer-events-none">
        <template x-for="toast in toasts" :key="toast.id">
            <div x-show="toast.visible" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-x-8"
                 x-transition:enter-end="opacity-100 translate-x-0"
                 x-transition:leave="transition ease-in duration-300"
                 x-transition:leave-start="opacity-100 translate-x-0"
                 x-transition:leave-end="opacity-0 translate-x-8"
                 class="bg-aura-dark text-white px-6 py-4 rounded shadow-2xl flex items-center gap-4 min-w-[320px] pointer-events-auto border-l-4"
                 :class="toast.type === 'error' ? 'border-aura-error' : 'border-aura-accent'">
                
                <i class="text-xl" 
                   :class="toast.type === 'error' ? 'ph-fill ph-warning-circle text-aura-error' : 'ph-fill ph-check-circle text-aura-accent'"></i>
                
                <div>
                    <h4 class="font-bold text-xs uppercase tracking-wider" x-text="toast.title"></h4>
                    <p class="text-xs text-white/80 mt-0.5" x-text="toast.message"></p>
                </div>
                
                <button @click="removeToast(toast.id)" class="ml-auto text-white/50 hover:text-white">
                    <i class="ph ph-x"></i>
                </button>
            </div>
        </template>
    </div>


    <header class="fixed top-0 w-full z-40 transition-all duration-500 ease-in-out"
            :class="scrolled ? 'glass-nav text-aura-dark py-4' : 'bg-transparent py-8 text-white'">
        
        <div class="container mx-auto px-6 flex justify-between items-center">
            
            <div class="flex items-center gap-4 w-1/3">
                <button @click="mobileMenuOpen = true" class="lg:hidden hover:text-aura-accent transition p-2 -ml-2">
                    <i class="ph ph-list text-2xl"></i>
                </button>
                
                <button class="hidden lg:flex items-center gap-2 hover:text-aura-accent transition group">
                    <i class="ph ph-magnifying-glass text-xl"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all -translate-x-2 group-hover:translate-x-0">Search</span>
                </button>

                <template x-if="isAdmin">
                    <a href="admin.html" class="hidden lg:flex items-center gap-2 bg-aura-dark text-white border border-white/20 px-4 py-2 rounded shadow-lg hover:bg-aura-accent transition transform hover:scale-105 group">
                        <i class="ph-fill ph-crown-simple text-aura-accent group-hover:text-white"></i>
                        <span class="text-[10px] font-bold uppercase tracking-widest">Admin Panel</span>
                    </a>
                </template>
            </div>

            <div class="w-1/3 text-center">
                <a href="#" class="inline-block group">
                    <h1 class="text-2xl md:text-3xl font-serif font-bold tracking-[0.2em] uppercase transition-colors group-hover:text-aura-accent">
                        Aura<span class="text-aura-accent group-hover:text-current">.</span>
                    </h1>
                </a>
            </div>

            <div class="flex items-center justify-end gap-6 w-1/3">
                <nav class="hidden lg:flex gap-8 text-[11px] font-bold tracking-widest uppercase">
                    <a href="#shop" class="hover:text-aura-accent transition relative group">
                        Shop
                        <span class="absolute -bottom-2 left-0 w-0 h-0.5 bg-aura-accent transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#about" class="hover:text-aura-accent transition relative group">
                        Our Story
                        <span class="absolute -bottom-2 left-0 w-0 h-0.5 bg-aura-accent transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </nav>

                <div class="h-4 w-px bg-current opacity-20 hidden lg:block"></div>
                
                <div x-data="{ open: false }" class="relative hidden lg:block">
                    <template x-if="!session">
                        <a href="loginpage.html" class="hover:text-aura-accent transition" title="Login">
                            <i class="ph ph-user text-xl"></i>
                        </a>
                    </template>
                    
                    <template x-if="session">
                        <div class="flex items-center gap-3">
                            <a href="profile.html" class="text-[10px] font-bold uppercase tracking-wider hover:text-aura-accent transition">
                                My Orders
                            </a>
                            <button @click="handleLogout" class="text-aura-error hover:text-red-400" title="Logout">
                                <i class="ph-bold ph-sign-out"></i>
                            </button>
                        </div>
                    </template>
                </div>
                
                <button @click="cartOpen = true" class="relative hover:text-aura-accent transition p-1 group">
                    <i class="ph ph-tote text-2xl group-hover:scale-110 transition-transform"></i>
                    <span x-show="cartCount > 0" 
                          x-cloak 
                          class="absolute -top-1 -right-1 bg-aura-accent text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold shadow-sm animate-bounce" 
                          x-text="cartCount"></span>
                </button>
            </div>
        </div>
    </header>


    <section class="relative h-screen w-full overflow-hidden flex items-center justify-center">
        <div class="absolute inset-0 z-0">
            <img src="https://images.unsplash.com/photo-1469334031218-e382a71b716b?q=80&w=2070&auto=format&fit=crop" 
                 alt="Aura Apparel Hero" 
                 class="w-full h-full object-cover object-center animate-pulse-slow scale-105 filter brightness-75">
            <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/20 to-aura-dark/90"></div>
        </div>

        <div class="relative z-10 text-center text-white px-4 max-w-5xl mt-10">
            <div class="overflow-hidden mb-8 flex justify-center">
                <span class="inline-block text-aura-accent font-bold tracking-[0.3em] uppercase text-[10px] md:text-xs animate-slide-up border border-aura-accent/40 bg-black/20 backdrop-blur-sm px-6 py-2 rounded-full">
                    Summer Collection 2026
                </span>
            </div>
            
            <h2 class="text-5xl md:text-7xl lg:text-9xl font-serif font-medium leading-[0.9] mb-8 text-shadow-lg animate-slide-up" style="animation-delay: 0.2s;">
                Ethical Luxury <br>
                <span class="italic font-light text-white/90">From Java.</span>
            </h2>
            
            <p class="max-w-xl mx-auto text-white/80 text-sm md:text-base mb-10 leading-relaxed font-light tracking-wide animate-slide-up" style="animation-delay: 0.4s;">
                Discover handcrafted apparel that honors tradition and embraces the future. 
                Sustainable materials, timeless designs, and zero compromise.
            </p>

            <div class="flex flex-col sm:flex-row gap-5 justify-center animate-slide-up" style="animation-delay: 0.6s;">
                <a href="#shop" class="bg-white text-aura-dark px-12 py-4 uppercase text-xs font-bold tracking-widest hover:bg-aura-accent hover:text-white transition duration-300 shadow-xl rounded-sm transform hover:-translate-y-1">
                    Shop Collection
                </a>
                <a href="#about" class="border border-white text-white px-12 py-4 uppercase text-xs font-bold tracking-widest hover:bg-white hover:text-aura-dark transition duration-300 rounded-sm">
                    Read Our Story
                </a>
            </div>
        </div>

        <div class="absolute bottom-10 left-1/2 -translate-x-1/2 text-white/50 animate-bounce">
            <i class="ph ph-caret-down text-2xl"></i>
        </div>
    </section>


    <section class="py-20 bg-aura-base border-b border-aura-dark/5">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12 text-center">
                <div class="flex flex-col items-center group">
                    <div class="w-16 h-16 rounded-full bg-aura-sand flex items-center justify-center mb-6 group-hover:bg-aura-accent group-hover:text-white transition duration-500">
                        <i class="ph ph-plant text-3xl"></i>
                    </div>
                    <h3 class="font-serif text-xl font-bold text-aura-dark mb-2">100% Organic</h3>
                    <p class="text-sm text-gray-500 leading-relaxed max-w-xs">Sourced directly from sustainable cotton farms in Central Java.</p>
                </div>
                <div class="flex flex-col items-center group">
                    <div class="w-16 h-16 rounded-full bg-aura-sand flex items-center justify-center mb-6 group-hover:bg-aura-accent group-hover:text-white transition duration-500">
                        <i class="ph ph-hand-heart text-3xl"></i>
                    </div>
                    <h3 class="font-serif text-xl font-bold text-aura-dark mb-2">Fair Trade</h3>
                    <p class="text-sm text-gray-500 leading-relaxed max-w-xs">Empowering local artisans with fair wages and safe working conditions.</p>
                </div>
                <div class="flex flex-col items-center group">
                    <div class="w-16 h-16 rounded-full bg-aura-sand flex items-center justify-center mb-6 group-hover:bg-aura-accent group-hover:text-white transition duration-500">
                        <i class="ph ph-recycle text-3xl"></i>
                    </div>
                    <h3 class="font-serif text-xl font-bold text-aura-dark mb-2">Zero Waste</h3>
                    <p class="text-sm text-gray-500 leading-relaxed max-w-xs">Our packaging is 100% biodegradable and plastic-free.</p>
                </div>
            </div>
        </div>
    </section>


    <main id="shop" class="bg-aura-base pt-24 pb-32">
        <div class="container mx-auto px-6">
            
            <div class="flex flex-col md:flex-row justify-between items-end mb-16 border-b border-aura-dark/10 pb-8">
                <div>
                    <span class="text-aura-accent font-bold uppercase tracking-widest text-xs mb-2 block">New Arrivals</span>
                    <h2 class="text-4xl md:text-5xl font-serif text-aura-dark mb-4">The Essentials</h2>
                    <p class="text-aura-charcoal/60 max-w-md font-light">Timeless pieces designed to be worn on repeat. Built to last, made to love.</p>
                </div>
                <div class="mt-6 md:mt-0">
                    <a href="catalog.html" class="group flex items-center gap-2 text-aura-dark font-bold uppercase tracking-widest text-xs hover:text-aura-accent transition">
                        View Full Catalog
                        <i class="ph-bold ph-arrow-right transform group-hover:translate-x-1 transition"></i>
                    </a>
                </div>
            </div>

            <div x-show="productsLoading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-16">
                <template x-for="i in 4">
                    <div class="animate-pulse">
                        <div class="bg-gray-200 aspect-[3/4] mb-4"></div>
                        <div class="h-4 bg-gray-200 w-3/4 mb-2"></div>
                        <div class="h-3 bg-gray-200 w-1/2"></div>
                    </div>
                </template>
            </div>

            <div x-show="!productsLoading && products.length === 0" class="text-center py-20 bg-white rounded border border-gray-100 shadow-sm" x-cloak>
                <div class="mb-4 text-gray-300">
                    <i class="ph ph-hanger text-6xl"></i>
                </div>
                <p class="text-gray-500 font-serif text-lg mb-2">No products found.</p>
                <p class="text-xs text-gray-400">Please add products via the Admin Dashboard.</p>
            </div>

            <div x-show="!productsLoading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-16" x-cloak>
                <template x-for="product in products" :key="product.id">
                    <div class="group relative flex flex-col h-full">
                        <div class="relative overflow-hidden bg-gray-100 aspect-[3/4] mb-6 cursor-pointer">
                            <img :src="product.image" 
                                 :alt="product.name" 
                                 class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110">
                            
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition duration-500"></div>

                            <div class="absolute top-4 left-4 flex flex-col gap-2">
                                <span x-show="product.badge" class="bg-white/95 backdrop-blur text-aura-dark text-[10px] font-bold uppercase tracking-widest px-3 py-1 shadow-sm" x-text="product.badge"></span>
                                <span x-show="product.is_new" class="bg-aura-dark text-white text-[10px] font-bold uppercase tracking-widest px-3 py-1 w-max shadow-sm border border-white/20">New</span>
                            </div>

                            <div class="absolute inset-x-0 bottom-0 p-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 bg-white/95 backdrop-blur-md border-t border-gray-100">
                                <p class="text-[10px] uppercase font-bold text-gray-400 mb-2 text-center">Select Size</p>
                                <div class="flex justify-center gap-2">
                                    <template x-for="size in ['S', 'M', 'L']">
                                        <button @click="addToCart(product, size)" 
                                                class="w-10 h-10 flex items-center justify-center border border-gray-200 hover:border-aura-dark hover:bg-aura-dark hover:text-white text-xs font-bold transition rounded-full">
                                            <span x-text="size"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-between items-start mt-auto">
                            <div>
                                <h3 class="font-serif text-lg text-aura-dark group-hover:text-aura-accent transition-colors cursor-pointer" x-text="product.name"></h3>
                                <p class="text-[11px] text-gray-500 mt-1 uppercase tracking-wide" x-text="product.category"></p>
                            </div>
                            <span class="font-bold text-aura-dark text-sm font-serif whitespace-nowrap" x-text="formatMoney(product.price)"></span>
                        </div>
                    </div>
                </template>
            </div>
            
            <div class="mt-20 text-center">
                <a href="catalog.html" class="inline-block border border-aura-dark text-aura-dark px-10 py-3 uppercase text-xs font-bold tracking-widest hover:bg-aura-dark hover:text-white transition duration-300">
                    Browse All Products
                </a>
            </div>
        </div>
    </main>


    <section id="about" class="bg-aura-dark text-white py-24 relative overflow-hidden">
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-aura-accent/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-96 h-96 bg-aura-accent/5 rounded-full blur-3xl"></div>

        <div class="container mx-auto px-6 relative z-10">
            <div class="flex flex-col md:flex-row items-center gap-16">
                <div class="w-full md:w-1/2">
                    <div class="relative">
                        <img src="https://images.unsplash.com/photo-1596704017254-9b121068fb31?q=80&w=2070" 
                             alt="Artisan at work" 
                             class="w-full h-[600px] object-cover rounded-sm filter sepia-[0.2]">
                        <div class="absolute -bottom-6 -right-6 w-full h-full border border-aura-accent/30 -z-10"></div>
                    </div>
                </div>
                <div class="w-full md:w-1/2">
                    <span class="text-aura-accent font-bold uppercase tracking-widest text-xs mb-4 block">Our Heritage</span>
                    <h2 class="text-4xl md:text-5xl font-serif mb-8 leading-tight">Preserving Culture,<br>One Stitch at a Time.</h2>
                    <div class="space-y-6 text-white/70 font-light leading-relaxed">
                        <p>
                            Aura Apparel was born from a desire to bridge the gap between traditional Indonesian craftsmanship and modern sustainable fashion.
                        </p>
                        <p>
                            Every piece in our collection tells a story. From the organic cotton fields in Java to the skilled hands of artisans in Yogyakarta, we ensure that every step of our supply chain honors both people and planet.
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-8 mt-12 border-t border-white/10 pt-8">
                        <div>
                            <h4 class="text-3xl font-serif text-aura-accent">100+</h4>
                            <p class="text-xs uppercase tracking-widest mt-1">Local Artisans</p>
                        </div>
                        <div>
                            <h4 class="text-3xl font-serif text-aura-accent">10k+</h4>
                            <p class="text-xs uppercase tracking-widest mt-1">Trees Planted</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <footer class="bg-[#0e231f] text-white pt-24 pb-12 border-t border-white/5">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-20">
                <div>
                    <a href="#" class="text-3xl font-serif font-bold tracking-widest text-white mb-6 block">AURA.</a>
                    <p class="text-white/50 text-sm leading-relaxed mb-8">
                        Redefining Indonesian fashion through sustainability and timeless design. Proudly made in Java.
                    </p>
                    <div class="flex gap-4">
                        <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-aura-accent hover:text-aura-dark transition"><i class="ph-fill ph-instagram-logo"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-aura-accent hover:text-aura-dark transition"><i class="ph-fill ph-facebook-logo"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-aura-accent hover:text-aura-dark transition"><i class="ph-fill ph-tiktok-logo"></i></a>
                    </div>
                </div>

                <div>
                    <h4 class="uppercase tracking-widest text-xs font-bold mb-8 text-aura-accent border-b border-white/10 pb-2 inline-block">Collections</h4>
                    <ul class="space-y-4 text-sm text-white/60">
                        <li><a href="#" class="hover:text-white transition flex items-center gap-2 group"><i class="ph ph-caret-right text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>New Arrivals</a></li>
                        <li><a href="#" class="hover:text-white transition flex items-center gap-2 group"><i class="ph ph-caret-right text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>Best Sellers</a></li>
                        <li><a href="#" class="hover:text-white transition flex items-center gap-2 group"><i class="ph ph-caret-right text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>Accessories</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="uppercase tracking-widest text-xs font-bold mb-8 text-aura-accent border-b border-white/10 pb-2 inline-block">Support</h4>
                    <ul class="space-y-4 text-sm text-white/60">
                        <li><a href="#" class="hover:text-white transition flex items-center gap-2 group"><i class="ph ph-caret-right text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>Shipping & Returns</a></li>
                        <li><a href="#" class="hover:text-white transition flex items-center gap-2 group"><i class="ph ph-caret-right text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>Size Guide</a></li>
                        <li><a href="#" class="hover:text-white transition flex items-center gap-2 group"><i class="ph ph-caret-right text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>Contact Us</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="uppercase tracking-widest text-xs font-bold mb-8 text-aura-accent border-b border-white/10 pb-2 inline-block">Studio</h4>
                    <ul class="space-y-6 text-sm text-white/60">
                        <li class="flex items-start gap-4">
                            <i class="ph ph-map-pin text-xl text-aura-accent mt-0.5"></i>
                            <span>Jl. Senopati No. 45,<br>Jakarta Selatan 12190<br>Indonesia</span>
                        </li>
                        <li class="flex items-start gap-4">
                            <i class="ph ph-envelope-simple text-xl text-aura-accent mt-0.5"></i>
                            <span>hello@auraapparel.id</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-white/5 pt-8 flex flex-col md:flex-row justify-between items-center text-[10px] text-white/30 uppercase tracking-widest">
                <p>&copy; 2026 Aura Apparel Indonesia. All rights reserved.</p>
                <div class="flex gap-6 mt-4 md:mt-0">
                    <a href="#" class="hover:text-white transition">Privacy Policy</a>
                    <a href="#" class="hover:text-white transition">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>


    <div class="relative z-50" aria-labelledby="slide-over-title" role="dialog" aria-modal="true" x-show="cartOpen" x-cloak>
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity" 
             x-show="cartOpen"
             x-transition:enter="ease-in-out duration-500"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="ease-in-out duration-500"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             @click="cartOpen = false"></div>

        <div class="fixed inset-0 overflow-hidden">
            <div class="absolute inset-0 overflow-hidden">
                <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 sm:pl-10">
                    <div class="pointer-events-auto w-screen max-w-md transform transition ease-in-out duration-500"
                         x-show="cartOpen"
                         x-transition:enter="translate-x-full"
                         x-transition:enter-end="translate-x-0"
                         x-transition:leave="translate-x-0"
                         x-transition:leave-end="translate-x-full">
                        
                        <div class="flex h-full flex-col bg-white shadow-2xl">
                            <div class="flex items-start justify-between px-4 py-6 sm:px-6 border-b border-gray-100 bg-aura-base">
                                <div>
                                    <h2 class="text-xl font-serif text-aura-dark font-bold">Shopping Bag</h2>
                                    <p class="text-xs text-gray-500 mt-1" x-text="cartCount + ' items'"></p>
                                </div>
                                <button type="button" class="text-gray-400 hover:text-aura-error transition p-2" @click="cartOpen = false">
                                    <i class="ph ph-x text-2xl"></i>
                                </button>
                            </div>

                            <div class="flex-1 overflow-y-auto px-4 py-6 sm:px-6 relative bg-white">
                                <div x-show="cartLoading" class="absolute inset-0 bg-white/80 z-10 flex items-center justify-center">
                                    <div class="spinner border-aura-dark"></div>
                                </div>

                                <template x-show="cart.length === 0 && !cartLoading">
                                    <div class="h-full flex flex-col items-center justify-center text-center opacity-50">
                                        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                                            <i class="ph ph-tote text-4xl text-aura-dark"></i>
                                        </div>
                                        <p class="text-gray-500 font-serif text-lg">Your bag is empty.</p>
                                        <button @click="cartOpen = false" class="mt-4 text-xs font-bold uppercase tracking-widest text-aura-accent hover:text-aura-dark underline">Start Shopping</button>
                                    </div>
                                </template>
                                
                                <ul role="list" class="-my-6 divide-y divide-gray-100">
                                    <template x-for="(item, index) in cart" :key="index">
                                        <li class="flex py-6 group">
                                            <div class="h-24 w-20 flex-shrink-0 overflow-hidden border border-gray-200 rounded-sm bg-gray-50">
                                                <img :src="item.image" class="h-full w-full object-cover object-center group-hover:scale-105 transition duration-500">
                                            </div>

                                            <div class="ml-4 flex flex-1 flex-col">
                                                <div>
                                                    <div class="flex justify-between text-base font-medium text-aura-dark">
                                                        <h3 x-text="item.name" class="font-serif pr-4 line-clamp-1"></h3>
                                                        <p class="whitespace-nowrap font-bold" x-text="formatMoney(item.price * item.quantity)"></p>
                                                    </div>
                                                    <div class="mt-1 flex items-center gap-2">
                                                        <p class="text-xs text-gray-500">Size: <span x-text="item.size" class="text-aura-dark font-bold"></span></p>
                                                    </div>
                                                </div>
                                                <div class="flex flex-1 items-end justify-between text-sm mt-2">
                                                    <div class="flex items-center border border-gray-200 rounded">
                                                        <span class="px-2 py-1 text-xs text-gray-500">Qty</span>
                                                        <span class="px-2 py-1 text-xs font-bold border-l border-gray-200 bg-gray-50" x-text="item.quantity"></span>
                                                    </div>

                                                    <button type="button" @click="removeFromCart(index, item)" class="flex items-center gap-1 text-aura-error/70 hover:text-aura-error text-[10px] uppercase tracking-wider transition font-bold">
                                                        <i class="ph-fill ph-trash"></i> Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <div class="border-t border-gray-100 px-4 py-6 sm:px-6 bg-aura-base/30">
                                <div class="flex justify-between text-base font-medium text-aura-dark mb-2">
                                    <p class="font-serif font-bold">Subtotal</p>
                                    <p class="font-bold" x-text="formatMoney(cartTotal)"></p>
                                </div>
                                <p class="mt-0.5 text-[10px] text-gray-500 mb-6">Shipping and taxes calculated at checkout.</p>
                                
                                <div class="space-y-3">
                                    <a href="checkout.html" class="flex items-center justify-center w-full bg-aura-dark text-white px-6 py-4 text-xs font-bold uppercase tracking-widest hover:bg-aura-accent hover:text-white transition duration-300 shadow-lg rounded-sm gap-2 group">
                                        Proceed to Checkout
                                        <i class="ph-bold ph-arrow-right group-hover:translate-x-1 transition"></i>
                                    </a>
                                    <button @click="cartOpen = false" class="w-full text-center text-xs font-bold uppercase tracking-widest text-gray-400 hover:text-aura-dark transition">
                                        Continue Shopping
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div x-show="mobileMenuOpen" class="fixed inset-0 z-[60] flex lg:hidden" x-cloak>
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" @click="mobileMenuOpen = false"></div>
        
        <div class="relative bg-aura-base w-4/5 max-w-sm h-full shadow-2xl flex flex-col transform transition-transform"
             x-transition:enter="translate-x-[-100%]"
             x-transition:enter-end="translate-x-0"
             x-transition:leave="translate-x-0"
             x-transition:leave-end="translate-x-[-100%]">
            
            <div class="p-6 flex justify-between items-center border-b border-gray-200">
                <span class="text-2xl font-serif font-bold text-aura-dark">AURA.</span>
                <button @click="mobileMenuOpen = false"><i class="ph ph-x text-2xl text-aura-dark"></i></button>
            </div>

            <nav class="flex-1 overflow-y-auto p-6 flex flex-col gap-6">
                <div x-show="session" class="bg-white p-4 rounded border border-gray-100 mb-2 flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-aura-dark text-white flex items-center justify-center font-bold">
                        <span x-text="session?.user?.email?.substring(0,2).toUpperCase()"></span>
                    </div>
                    <div class="overflow-hidden">
                        <p class="text-xs font-bold text-gray-400 uppercase">Logged in as</p>
                        <p class="text-sm font-bold truncate w-32" x-text="session?.user?.email"></p>
                    </div>
                </div>

                <div class="flex flex-col space-y-4 text-lg font-serif text-aura-dark">
                    <a href="#" class="border-b border-gray-100 pb-2">Home</a>
                    <a href="#shop" class="border-b border-gray-100 pb-2">Shop Collection</a>
                    <a href="#about" class="border-b border-gray-100 pb-2">Our Story</a>
                    <a href="catalog.html" class="border-b border-gray-100 pb-2 text-aura-accent">All Products</a>
                </div>

                <template x-if="isAdmin">
                     <a href="admin.html" class="bg-aura-dark text-white p-4 rounded text-center text-xs font-bold uppercase tracking-widest shadow-lg flex items-center justify-center gap-2">
                        <i class="ph-fill ph-crown-simple"></i> Admin Dashboard
                    </a>
                </template>
            </nav>

            <div class="p-6 bg-gray-50 border-t border-gray-200">
                 <div x-show="!session">
                    <a href="loginpage.html" class="block w-full text-center bg-aura-dark text-white py-4 text-xs font-bold uppercase tracking-widest rounded-sm shadow-md">Login / Register</a>
                </div>
                <div x-show="session">
                    <button @click="handleLogout" class="block w-full text-center border border-aura-error text-aura-error py-4 text-xs font-bold uppercase tracking-widest rounded-sm hover:bg-red-50">Sign Out</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        function shopApp() {
            return {
                /* --- STATE VARIABLES --- */
                supabase: null,
                session: null,
                isAdmin: false,
                
                // UI States
                scrolled: false,
                mobileMenuOpen: false,
                cartOpen: false,
                cartLoading: false,
                productsLoading: true,
                
                // Data Storage
                products: [], 
                cart: [],
                toasts: [],

                /* --- COMPUTED PROPERTIES --- */
                get cartTotal() { 
                    return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0); 
                },
                get cartCount() { 
                    return this.cart.reduce((total, item) => total + item.quantity, 0); 
                },

                /* --- INITIALIZATION --- */
                init() {
                    // Scroll listener
                    window.addEventListener('scroll', () => { 
                        this.scrolled = window.scrollY > 50; 
                    });
                    
                    this.initSupabase();
                },

                async initSupabase() {
                    const sbUrl = 'https://xenosyklkpisszqwibdw.supabase.co';
                    const sbKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhlbm9zeWtsa3Bpc3N6cXdpYmR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTkxNzcsImV4cCI6MjA4NjQzNTE3N30.A_WVC9GRa7USe2DPbzVUWw3TuBHnyImVqBZnzuPJbMw';
                    
                    if (typeof supabase !== 'undefined') {
                        this.supabase = supabase.createClient(sbUrl, sbKey);
                        
                        // 1. Load Data
                        await this.fetchProducts();

                        // 2. Check Authentication
                        const { data: { session } } = await this.supabase.auth.getSession();
                        this.handleSessionChange(session);
                        
                        // 3. Listen for Auth Changes
                        this.supabase.auth.onAuthStateChange((_event, session) => {
                            this.handleSessionChange(session);
                        });
                    }
                },

                /* --- DATA FETCHING --- */
                async fetchProducts() {
                    this.productsLoading = true;
                    try {
                        // Fetch newest 8 items
                        const { data, error } = await this.supabase
                            .from('products')
                            .select('*')
                            .order('created_at', { ascending: false })
                            .limit(8); 
                        
                        if (error) throw error;
                        this.products = data;
                    } catch (e) {
                        console.error('Error loading products:', e);
                        this.showToast('Failed to load collection.', 'Network Error', 'error');
                    } finally {
                        this.productsLoading = false;
                    }
                },

                async handleSessionChange(session) {
                    this.session = session;
                    
                    // ADMIN CHECK
                    if (session && session.user.email === 'dashwebtr3@gmail.com') {
                        this.isAdmin = true;
                    } else {
                        this.isAdmin = false;
                    }

                    if (session) {
                        await this.syncGuestCartToCloud();
                        await this.fetchCloudCart();
                    } else {
                        this.loadLocalCart();
                    }
                },

                /* --- CART LOGIC --- */
                async addToCart(product, size) {
                    this.cartOpen = true; 
                    
                    if (!this.session) {
                        // GUEST: Use LocalStorage
                        this.addToLocalCart(product, size);
                    } else {
                        // LOGGED IN: Use Database
                        await this.addToCloudCart(product, size);
                    }
                },

                addToLocalCart(product, size) {
                    const existingItem = this.cart.find(i => i.id === product.id && i.size === size);
                    if (existingItem) {
                        existingItem.quantity++;
                    } else {
                        // Deep copy product to avoid reference issues
                        const item = JSON.parse(JSON.stringify(product));
                        item.size = size;
                        item.quantity = 1;
                        this.cart.push(item);
                    }
                    this.saveLocalCart();
                    this.showToast(`${product.name} added to bag.`);
                },

                async addToCloudCart(product, size) {
                    this.cartLoading = true;
                    try {
                        // Calculate new quantity based on local state (optimistic UI)
                        const existingItem = this.cart.find(i => i.id === product.id && i.size === size);
                        const newQty = existingItem ? existingItem.quantity + 1 : 1;

                        const { error } = await this.supabase
                            .from('cart_items')
                            .upsert({ 
                                user_id: this.session.user.id,
                                product_id: product.id, 
                                size: size,
                                quantity: newQty
                            }, { onConflict: 'user_id, product_id, size' });

                        if (error) throw error;
                        
                        await this.fetchCloudCart(); // Refresh source of truth
                        this.showToast(`${product.name} saved to account.`);
                    } catch (e) {
                        console.error('Cart Error:', e);
                        this.showToast('Could not save to cart.', 'Error', 'error');
                    } finally {
                        this.cartLoading = false;
                    }
                },

                async removeFromCart(index, item) {
                    if (!this.session) {
                        this.cart.splice(index, 1);
                        this.saveLocalCart();
                    } else {
                        this.cartLoading = true;
                        try {
                            const { error } = await this.supabase
                                .from('cart_items')
                                .delete()
                                .match({ 
                                    user_id: this.session.user.id, 
                                    product_id: item.id, 
                                    size: item.size 
                                });
                            
                            if (error) throw error;
                            this.cart.splice(index, 1); // Optimistic update
                        } catch (e) { 
                            console.error('Delete Error:', e);
                            this.showToast('Failed to remove item.', 'Error', 'error');
                        } finally { 
                            this.cartLoading = false; 
                        }
                    }
                },

                async fetchCloudCart() {
                    try {
                        const { data, error } = await this.supabase.from('cart_items').select('*');
                        if (error) throw error;
                        
                        // We need to merge the DB cart (IDs) with Product Info (Names, Images, Prices)
                        // We filter through 'this.products'. NOTE: If a product isn't in the top 8 loaded,
                        // it might show as missing info. In a full app, we would fetch specific IDs.
                        // For this demo, we assume the catalog is small enough or loaded enough.
                        this.cart = data.map(row => {
                            const productInfo = this.products.find(p => p.id === row.product_id);
                            
                            // Fallback if product not found in current loaded list
                            if (!productInfo) return null; 
                            
                            return { ...productInfo, size: row.size, quantity: row.quantity };
                        }).filter(Boolean);
                    } catch (e) { console.error('Fetch Cart Error:', e); }
                },

                /* --- STORAGE HELPERS --- */
                saveLocalCart() { localStorage.setItem('aura_cart_guest', JSON.stringify(this.cart)); },
                loadLocalCart() { const stored = localStorage.getItem('aura_cart_guest'); if (stored) this.cart = JSON.parse(stored); },
                
                async syncGuestCartToCloud() {
                    const guestCart = JSON.parse(localStorage.getItem('aura_cart_guest') || '[]');
                    if (guestCart.length > 0) {
                        this.showToast('Syncing your cart...', 'Login Success');
                        for (const item of guestCart) {
                            await this.addToCloudCart(item, item.size);
                        }
                        localStorage.removeItem('aura_cart_guest');
                    }
                },

                /* --- UTILITIES --- */
                async handleLogout() { 
                    if (this.supabase) { 
                        await this.supabase.auth.signOut(); 
                        this.cart = [];
                        this.isAdmin = false;
                        this.showToast('You have been logged out.');
                    } 
                },

                formatMoney(amount) { 
                    return new Intl.NumberFormat('id-ID', { 
                        style: 'currency', 
                        currency: 'IDR', 
                        maximumSignificantDigits: 9 
                    }).format(amount); 
                },

                showToast(message, title = 'Notification', type = 'success') {
                    const id = Date.now();
                    this.toasts.push({ id, message, title, type, visible: true });
                    // Auto dismiss
                    setTimeout(() => {
                        this.removeToast(id);
                    }, 4000);
                },

                removeToast(id) {
                    const index = this.toasts.findIndex(t => t.id === id);
                    if (index > -1) {
                        this.toasts[index].visible = false;
                        // Remove from array after animation finishes
                        setTimeout(() => {
                            this.toasts = this.toasts.filter(t => t.id !== id);
                        }, 300);
                    }
                }
            }
        }
    </script>
</body>
</html>
